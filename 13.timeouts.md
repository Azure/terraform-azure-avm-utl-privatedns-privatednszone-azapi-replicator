# Task #13: timeouts (Block Structure Skeleton)

## Summary
Created structure skeleton for root-level `timeouts` block. The `timeouts` block is a Terraform provider meta-argument that controls operation timeout durations, NOT an Azure API property. Implementation is handled by updating the `timeouts` variable in `variables.tf` with correct default values and adding a `timeouts` output to `migrate_outputs.tf`. No shadow module `locals` changes are needed.

## Shadow Implementation
```hcl
# variables.tf
variable "timeouts" {  # <-
  type = object({  # <-
    create = optional(string, "30m")  # <- Task #14
    delete = optional(string, "30m")  # <- Task #15
    read   = optional(string, "5m")  # <- Task #16
    update = optional(string, "30m")  # <- Task #17
  })  # <-
  default = {  # <-
    create = "30m"  # <- Task #14
    delete = "30m"  # <- Task #15
    read   = "5m"  # <- Task #16
    update = "30m"  # <- Task #17
  }  # <-
  nullable    = false  # <-
  description = <<-EOT  # <-
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.  # <- Task #14
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.  # <- Task #15
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.  # <- Task #16
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.  # <- Task #17
EOT  # <-
}  # <-

# migrate_outputs.tf
output "timeouts" {  # <-
  value = var.timeouts  # <-
}  # <-
```

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is NOT part of Azure API request/response. It's a Terraform provider-level meta-argument that controls how long operations wait before timing out.

From `resourcePrivateDnsZone()` in provider source code:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- Create default: **30 minutes** (`30 * time.Minute`)
- Read default: **5 minutes** (`5 * time.Minute`)
- Update default: **30 minutes** (`30 * time.Minute`)
- Delete default: **30 minutes** (`30 * time.Minute`)

**Decision:** This is a resource-level meta-argument, not a request body property. No implementation in `migrate_main.tf` locals is needed.

## Assignment Path Verification

**N/A** - Timeouts are meta-arguments, not Azure API properties. They are not assigned to request body paths.

## Provider Schema

From `resourcePrivateDnsZone()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Properties:**
- **Type**: Block (MaxItems: 1)
- **Optional**: Yes
- **Computed**: No
- **ForceNew**: No

**Child Arguments:**
- `create`: Optional, Default: 30 minutes
- `delete`: Optional, Default: 30 minutes
- `read`: Optional, Default: 5 minutes
- `update`: Optional, Default: 30 minutes

## Azure API Schema

**N/A** - The `timeouts` block is not part of the Azure API schema. It's a Terraform provider meta-argument.

## Hidden Fields

**None** - The `timeouts` block has no hidden fields. All four timeout operations (create, read, update, delete) are explicitly defined in the provider schema.

## Mapping

**N/A** - No mapping to Azure API properties. Timeouts are consumed directly by the parent module's `azapi_resource` block.

## Special Handling

### Implementation Location

According to `timeouts.md`:

1. **NO shadow module changes** - The `timeouts` block is NOT implemented in `migrate_main.tf` locals (no body, sensitive_body, etc.)
2. **Variable configuration** - Updated `variables.tf` with:
   - Correct `optional(string, "XXm")` values matching provider defaults
   - `default` block with explicit values matching type definition
   - `nullable = false` to prevent null values
   - Descriptive text for each timeout operation
3. **Output configuration** - Added `output "timeouts"` to `migrate_outputs.tf` to pass the variable to parent module

### Default Values Synchronization

**CRITICAL:** The values in the `default` block MUST exactly match the default values defined in the `optional(string, "XXm")` parameters in the `type` definition:

- `create = optional(string, "30m")` → `default { create = "30m" }`
- `delete = optional(string, "30m")` → `default { delete = "30m" }`
- `read = optional(string, "5m")` → `default { read = "5m" }`
- `update = optional(string, "30m")` → `default { update = "30m" }`

## Deferred Work Completion

Not applicable - no deferred work found in `following.md` for this task.

## Critical Review & Edge Case Analysis

### Null Semantics
- ✅ **`nullable = false`** ensures the variable never receives `null` value
- ✅ **`default` block** provides explicit values for all timeout operations
- ✅ Each timeout field uses `optional(string, "XXm")` to provide field-level defaults

### Edge Cases
- ✅ **Empty string**: Not possible - Terraform validates timeout format
- ✅ **Invalid format**: Terraform validates timeout string format (e.g., "30m", "1h")
- ✅ **Negative values**: Not possible - Terraform validates positive duration
- ✅ **Zero values**: Valid but unusual - would cause immediate timeout

### Idempotency
- ✅ **Deterministic**: Same timeout values always produce same behavior
- ✅ **No state dependency**: Timeouts are static configuration, not dependent on resource state

### Safe References
- ✅ **Direct variable reference**: `var.timeouts` is always safe - never null due to `nullable = false`
- ✅ **Output value**: Parent module can safely consume `module.migrate.timeouts` without null checks

### Parent Module Usage
The parent module will use the output as:
```hcl
resource "azapi_resource" "this" {
  type      = module.migrate.azapi_header.type
  name      = module.migrate.azapi_header.name
  # ... other parameters ...
  
  timeouts {
    create = module.migrate.timeouts.create
    delete = module.migrate.timeouts.delete
    read   = module.migrate.timeouts.read
    update = module.migrate.timeouts.update
  }
}
```

## Child Tasks Ready for Delegation

The following child tasks are now ready for delegation:

- **Task #14**: `timeouts.create` - Update description text for create timeout
- **Task #15**: `timeouts.delete` - Update description text for delete timeout  
- **Task #16**: `timeouts.read` - Update description text for read timeout
- **Task #17**: `timeouts.update` - Update description text for update timeout

**Note**: All default values have already been configured in the skeleton (Task #13). Child tasks only need to verify the defaults are correct per `timeouts.md` guidelines.

## Checklist

- ✅ Property in correct location (`variables.tf` and `migrate_outputs.tf`)
- ✅ ForceNew handled: N/A - timeouts are meta-arguments
- ✅ All logic exactly replicated from provider (timeout defaults extracted from source)
- ✅ Validations: N/A - Terraform validates timeout format
- ✅ TODO comment: N/A - no sensitive fields
- ✅ Hidden fields checked: None found
- ✅ Deferred work in following.md: None to defer
- ✅ Deferred work from following.md: None found
- ✅ Critical review completed (null, edge, idempotent, safe refs)
- ✅ Edge Case Analysis in proof: Documented above
- ✅ Proof created: This document
- ✅ Self-Review: Only skeleton structure added; individual timeout field descriptions are placeholders for child tasks #14-17

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-23
**Task:** #13 - timeouts

### Validation Results

✅ **Timeout Defaults:** Correctly extracted from provider source code
  - Create: 30 minutes (`30 * time.Minute` → `"30m"`)
  - Delete: 30 minutes (`30 * time.Minute` → `"30m"`)
  - Read: 5 minutes (`5 * time.Minute` → `"5m"`)
  - Update: 30 minutes (`30 * time.Minute` → `"30m"`)

✅ **Type/Default Synchronization:** Perfect match between `optional(string, "XXm")` in type and values in `default` block

✅ **nullable = false:** Explicitly set as required by executor.md

✅ **No Shadow Module Changes:** Correctly followed timeouts.md rule - no implementation in migrate_main.tf locals

✅ **Output Configuration:** `output "timeouts"` exists in migrate_outputs.tf

✅ **Meta-Argument Understanding:** Correctly identified as Terraform provider meta-argument, not Azure API property

✅ **Edge Cases:** Properly analyzed null semantics, format validation, and parent module usage

✅ **Deferred Work:** No items found in following.md for this task

### Provider Source Evidence

From `resourcePrivateDnsZone()`:
```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

### Implementation Verification

**variables.tf (lines 106-127):**
- Type definition: `create = optional(string, "30m")` matches `default { create = "30m" }`
- Type definition: `delete = optional(string, "30m")` matches `default { delete = "30m" }`
- Type definition: `read = optional(string, "5m")` matches `default { read = "5m" }`
- Type definition: `update = optional(string, "30m")` matches `default { update = "30m" }`
- `nullable = false` present

**migrate_outputs.tf (lines 42-44):**
- Output exists and correctly passes `var.timeouts`

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and follows the special rules in `timeouts.md`. The timeout defaults are correctly extracted from the provider source code, the variable configuration properly synchronizes type defaults with the default block, and the meta-argument nature is correctly understood (no shadow module locals implementation). The output is properly configured to pass timeouts to the parent module's `azapi_resource` block.

**Status:** APPROVED ✅

---
